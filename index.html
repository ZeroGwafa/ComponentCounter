<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/nis.css"/>
	<link rel="stylesheet" type="text/css" href="css/style.css" >
    
    <!-- runeapps scripts -->
    <script type="text/javascript" src="/ComponentCounter/scripts/runeappslib.js"></script>
    <script type="text/javascript" src="/ComponentCounter/scripts/jquery.js"></script>
    <script type="text/javascript" src="/ComponentCounter/scripts/alt1lib.js"></script>
    <script type="text/javascript" src="/ComponentCounter/scripts/imagedetect.js"></script>
	<script type="text/javascript" src="/ComponentCounter/scripts/chatbox.js"></script>
	<!-- Telos main script 
	<script type="text/javascript" src="/scripts/script.js"></script>-->
</head>
<body class="nis">
	<div class="header">
        <table class='ui'>
        <tr>
            <th><button class="tracker nisbutton">Start</button></th>
            <th><button class="clear nisbutton">Clear</button></th>
        </tr>
        </table>
	</div>
	<div class="curestate" id="overview">
        
        
	<table>
        <tr><th>Components</th><th>Quantity</th></tr>
        <tr><td>Junk</td><td></td></tr>
        <tr><td>Base parts</td><td></td></tr>
        <tr><td>Blade parts</td><td></td></tr>
        <tr><td>Clear parts</td><td></td></tr>
        <tr><td>Connector parts</td><td></td></tr>
        <tr><td>Cover parts</td><td></td></tr>
        <tr><td>Crafted parts</td><td></td></tr>
        <tr><td>Crystal parts</td><td></td></tr>
        <tr><td>Deflecting parts</td><td></td></tr>
        <tr><td>Delicate parts</td><td></td></tr>
        <tr><td>Flexible parts</td><td></td></tr>
        <tr><td>Head parts</td><td></td></tr>
        <tr><td>Magic parts</td><td></td></tr>
        <tr><td>Metallic parts</td><td></td></tr>
        <tr><td>Organic parts</td><td></td></tr>
        <tr><td>Padded parts</td><td></td></tr>
        <tr><td>Plated parts</td><td></td></tr>
        <tr><td>Simple parts</td><td></td></tr>
        <tr><td>Smooth parts</td><td></td></tr>
        <tr><td>Spiked parts</td><td></td></tr>
        <tr><td>Spiritual parts</td><td></td></tr>
        <tr><td>Stave parts</td><td></td></tr>
        <tr><td>Tensile parts</td><td></td></tr>
        <tr><td>Dextrous components</td><td></td></tr>
        <tr><td>Direct components</td><td></td></tr>
        <tr><td>Enhancing components</td><td></td></tr>
        <tr><td>Ethereal components</td><td></td></tr>
        <tr><td>Evasive components</td><td></td></tr>
        <tr><td>Healthy components</td><td></td></tr>
        <tr><td>Heavy components</td><td></td></tr>
        <tr><td>Imbued components</td><td></td></tr>
        <tr><td>Light components</td><td></td></tr>
        <tr><td>Living components</td><td></td></tr>
        <tr><td>Pious components</td><td></td></tr>
        <tr><td>Powerful components</td><td></td></tr>
        <tr><td>Precious components</td><td></td></tr>
        <tr><td>Precise components</td><td></td></tr>
        <tr><td>Protective components</td><td></td></tr>
        <tr><td>Refined components</td><td></td></tr>
        <tr><td>Sharp components</td><td></td></tr>
        <tr><td>Strong components</td><td></td></tr>
        <tr><td>Stunning components</td><td></td></tr>
        <tr><td>Subtle components</td><td></td></tr>
        <tr><td>Swift components</td><td></td></tr>
        <tr><td>Variable components</td><td></td></tr>
        <tr><td>Ancient components</td><td></td></tr>
        <tr><td>Armadyl components</td><td></td></tr>
        <tr><td>Ascended components</td><td></td></tr>
        <tr><td>Avernic components</td><td></td></tr>
        <tr><td>Bandos components</td><td></td></tr>
        <tr><td>Brassican components</td><td></td></tr>
        <tr><td>Clockwork components</td><td></td></tr>
        <tr><td>Corporeal components</td><td></td></tr>
        <tr><td>Culinary components</td><td></td></tr>
        <tr><td>Cywir components</td><td></td></tr>
        <tr><td>Dragonfire components</td><td></td></tr>
        <tr><td>Explosive components</td><td></td></tr>
        <tr><td>Faceted components</td><td></td></tr>
        <tr><td>Fortunate components</td><td></td></tr>
        <tr><td>Fungal components</td><td></td></tr>
        <tr><td>Harnessed components</td><td></td></tr>
        <tr><td>Ilujankan components</td><td></td></tr>
        <tr><td>Knightly components</td><td></td></tr>
        <tr><td>Noxious components</td><td></td></tr>
        <tr><td>Oceanic components</td><td></td></tr>
        <tr><td>Pestiferous components</td><td></td></tr>
        <tr><td>Resilient components</td><td></td></tr>
        <tr><td>Rumbling components</td><td></td></tr>
        <tr><td>Saradomin components</td><td></td></tr>
        <tr><td>Seren components</td><td></td></tr>
        <tr><td>Shadow components</td><td></td></tr>
        <tr><td>Shifting components</td><td></td></tr>
        <tr><td>Silent components</td><td></td></tr>
        <tr><td>Undead components</td><td></td></tr>
        <tr><td>Zamorak components</td><td></td></tr>
        <tr><td>Zaros components</td><td></td></tr>
    </table>
	</div>
	
<script>

    var reader = new ChatBoxReader();
        reader.readargs = {
            colors: [
                a1lib.mixcolor(255,255,255),//Common Mats
                a1lib.mixcolor(255, 128, 0), //Uncommon Mats
                a1lib.mixcolor(255, 165, 0), //Scavenging comps
                a1lib.mixcolor(255, 0, 0) //Rare Mats
            ],
            backwards: true
        };
        reader.find();
        var chatCheck = reader.read();
    var old_lines = [];
    var list = ["Junk", "Base parts", "Blade parts", "Clear parts", "Connector parts", "Cover parts", "Crafted parts", "Crystal parts", "Deflecting parts", "Delicate parts", "Flexible parts", "Head parts", "Magic parts", "Metallic parts", "Organic parts", "Padded parts", "Plated parts", "Simple parts", "Smooth parts", "Spiked parts", "Spiritual parts", "Stave parts", "Tensile parts", "Dextrous components", "Direct components", "Enhancing components", "Ethereal components", "Evasive components", "Healthy components", "Heavy components", "Imbued components", "Light components", "Living components", "Pious components", "Powerful components", "Precious components", "Precise components", "Protective components", "Refined components", "Sharp components", "Strong components", "Stunning components", "Subtle components", "Swift components", "Variable components", "Ancient components", "Armadyl components", "Ascended components", "Avernic components", "Bandos components", "Brassican components", "Clockwork components", "Corporeal components", "Culinary components", "Cywir components", "Dragonfire components", "Explosive components", "Faceted components", "Fortunate components", "Fungal components", "Harnessed components", "Ilujankan components", "Knightly components", "Noxious components", "Oceanic components", "Pestiferous components", "Resilient components", "Rumbling components", "Saradomin components", "Seren components", "Shadow components", "Shifting components", "Silent components", "Undead components", "Zamorak components", "Zaros components"]
    var list2 = new Array();
        list2.length = list.length;
        list2.fill(0);
    var count, mats, index;

var stamps_used = false;
function readChatbox() {
	var new_lines 	= [];
	var opts 		= reader.read() 		|| [];
    var chat = "";
    reader.find();
    for(a in opts)
    {
            chat += opts[a].text + " ";
    }
    
        
        var comps = chat.match(/\d+ x \w+( \w+)?/g);
        for (var x in comps)
        {
            console.log(comps[x]);
            count = comps[x].split(" x ")[0]; //1
            mats = comps[x].split(" x ")[1].trim(); //Junk
            index = list.indexOf(mats);//Get index of mat based off of list.
            list2[index] += Number(count); //add count to index of second list.
            tidyTable();
        }
}    
    var tracker;
    $("button.tracker").click(function(){
        if($(this).html() == "Start")
        {
            console.log("Starting tracker");
            tracking = setInterval(function(){readChatbox();},600);
            $(this).html("Stop");
        }
        else
            {
                console.log("Stopping tracker");
                $(this).html("Start");
                clearInterval(tracking);
            }
    });
    $("button.clear").click(function(){
        list2.fill(0);
        tidyTable();
    });
    
    function tidyTable()
    {
        localStorage.mats = list2;
        $("table:contains('parts') tr:not(:first)").hide();
        $("tr:not(:first) > td:nth-child(2)").each(function(e){
                    $(this).text(list2[e]);//update all table rows.
                    });
        for(x in list2)
        {
            if(list2[x] != 0)
            {
		      $("table:contains('parts') tr:not(:first)").eq(x).show();
            }
        }
    }
    if(localStorage.mats.length)
        {
            list2 = localStorage.mats.split(',');
        }
    else
        {
            list2.fill(0);
        }
    tidyTable();
</script>	
</body>
</html>
